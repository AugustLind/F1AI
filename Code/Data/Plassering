import requests
import csv
import fastf1
import fastf1.plotting


# URL til API-en som gir resultater for alle løp i 2023-sesongen
base_url = "http://ergast.com/api/f1/2023/results.json?limit=1000"

# Opprett en tom diksjonær for å lagre plasseringene til førerne
driver_positions = {}

# Hent data fra API-en
response = requests.get(base_url)

# Sjekk om forespørselen var vellykket
if response.status_code == 200:
    # Hent JSON-data fra responsen
    data = response.json()

    # Hent resultatene fra alle løpene i 2023-sesongen
    races = data.get("MRData", {}).get("RaceTable", {}).get("Races", [])

    # Gå gjennom hvert løp og hent plasseringene til førerne
    for race in races:
        results = race.get("Results", [])

        # Gå gjennom resultatene for hvert løp
        for result in results:
            position = result.get("position", "N/A")
            driver_name = f"{result['Driver']['givenName']} {result['Driver']['familyName']}"

            # Legg til førerens plassering i diksjonæren
            if driver_name not in driver_positions:
                driver_positions[driver_name] = []
            driver_positions[driver_name].append(position)

# Skriv data til CSV-filen
csv_file = "driver_positions.csv"

with open(csv_file, "w", newline="") as csvfile:
    csv_writer = csv.writer(csvfile)
    
    # Skriv headeren til CSV-filen
    csv_writer.writerow(["Driver", "Positions"])
    
    # Skriv dataen for hver fører
    for driver, positions in driver_positions.items():
        csv_writer.writerow([driver, ", ".join(positions)])

print(f"Data has been saved to {csv_file}")
